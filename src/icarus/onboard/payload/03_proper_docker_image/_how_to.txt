# 1 build
# needs access to > spacecloud.unibap.com/unibap/framework-missionimage:latest bash
sudo docker build -t helio_payload .

# 2 run commands
# easy run
sudo docker run -it -v /dev/bus/usb:/dev/bus/usb --device-cgroup-rule='c 189:* rmw' --rm -v "/$(pwd)/payload":/payload -v "/$(pwd)/results":/results -v "/$(pwd)/weights":/weights -v "/$(pwd)/data":/data -m 2g helio_payload


# with more details and bash
sudo docker run -it -v /dev/bus/usb:/dev/bus/usb \
        --device-cgroup-rule='c 189:* rmw' \
        --rm -v "/$(pwd)/payload":/payload -v "/$(pwd)/results":/results -v "/$(pwd)/weights":/weights -v "/$(pwd)/data":/data -m 2g  \
        helio_payload bash

./run_all


# 3 run reconstruction outside of the docker image
(conda create -c conda-forge -n fdl23_compressai python=3.10 mamba)
(conda activate fdl23_compressai)
(pip install sunpy zeep drms hvpy openvino-dev==2023.0.1 pytorch_msssim compressai onnx onnxruntime)

conda activate fdl23_compressai
python reconstruction/reconstruct.py